# NURBS 曲线与曲面

> 此部分内容是新扩展的，相对没那么重要。

## NURBS 的基本概念

B样条曲线在表示和设计自由型曲线曲面形状方面显示了强大的威力。

• 在表示与设计由二次曲面与平面构成的初等曲面时却遇到了麻烦 – B样条曲线(面)包括其特例*B**é**zier*曲线(面)都只能近似的表示出抛物线(面)以外的二次曲线弧(面)。

• 近似表示将带来处理上的麻烦，使本来简单的问题复杂化，还会带来原不存在的设计误差问题

我们通过改造 B 样条曲线，得到了「有理 B 样条曲线」，可以解决这些问题。这种曲线的定义如下：

$$
P(t)=\dfrac{\Sigma_{i=0}^n\omega_iP_iN_{i,k}(t)}{\Sigma_{i=0}^n\omega_iN_{i,k}(t)}
$$
• Pi 是 n+1 个控制点的位置;

• 参数ωi是控制点的权因子: ωi 值越大，有理 B 样条曲线越靠近该控制点Pi

> NURBS 就是有理 B 样条曲线的简称。
>
> 由于这种曲线的定义式是一个分数，而且分子分母都是有理的多项式，因此这个式子符合有理数的定义形式，我们就叫它有理 B 样条曲线了（

有理 B 样条曲线是 B 样条曲线的扩展：**当所有权因子都为1时得标准B样条曲线。**

构造有理 B 样条曲线需要：

给定控制点集;节点向量;多项式次数;权因子

有理 B 样条曲线相比于一般的 B 样条曲线，在构造上多需要一个参数：**权因子**。当所有权因子都为1时得标准B样条曲线。

<mark>选择考点</mark>

<mark>非有理样条关于透视观察变换是可变的，有理样条对于透视观察变换是不变的</mark>

即参数有理多项式的投影还是参数有理多项式。

### NURBS 方法的优点和缺点:

- 既为标准解析形状（B 样条/贝塞尔曲线）也为自由型曲线曲面（抛物线等曲线）的精确表示与设计提供了统一数学形式;

- 修改控制顶点和权因子，为各种形状设计提供了充分的灵活性;

- 计算稳定且速度快;

- 具有明显的几何解释和强有力的几何配套技术(插 入节点/细分/消去、升阶、分裂等);

- <mark>在几何变换及平行和透视投影变换下不变</mark>（重要区别）; 
- 是非有理 B 样条和 Bézier 形式合适的推广，在特定情况下（权因子全部为 1）可以退化为 B 样条曲线，同时满足 B 样条曲线退化的条件时，甚至可以退化为贝塞尔曲线

缺点：

- 需要额外的存储以定义传统的曲线曲面（比如 NURBS 存储圆形所需的参数比直接存圆的圆心+半径要多）

- 权因子选择不当会引起畸变;
- 某些技术用传统形式比NURBS工作得好;
- 某些基本算法存在数值不稳定问题，如点的反求

### NURBS 曲线的定义

$$
P(t)=\dfrac{\Sigma_{i=0}^n\omega_iP_iN_{i,k}(t)}{\Sigma_{i=0}^n\omega_iN_{i,k}(t)}
$$

上下方的差别在于下方少了个 $P_i$ 部分（控制顶点的坐标）

- 参数ωi是控制顶点权因子，与控制顶点Pi相联系

  首末权因子一般 > 0（非零），其余 ωi≥0，以防止分母为零、保留凸包性质及曲线不致于权因子而退化为一点。

- 控制顶点Pi(i=0,1,2,...,n)顺序连接，形成「控制多边形」

- Ni,k(t) 是由节点向量 T={t0,t1,t2,...,tn+k) 按递推公式决定的 k 阶规范 B 样条基函数（人话：和一般 B 样条曲线基函数的定义完全一样）

应用：

- 对于非周期NURBS曲线，常将两端节点的重复度取为k，即取：t0=t1=t2,...,tk-1,tn+1=tn+2=...=tn+k。

- 在大多数实际应用里，端节点值分别取为 0 和 1， 因此，曲线定义域:t∈[tk-1,tn+1]=[0,1]。

- 当 n=(k-1) 时，k 阶NURBS曲线就成为k阶有理 Bézier 曲线（注意仍然不是一般贝塞尔曲线）**:**

  – k阶NURBS曲线节点向量两端节点重复度取k，就使曲线具有同次有理Bézier曲线端点几何性质

  – 如果权因子ω1,ωn-1≠0，曲线首末端点分别就是控制多边形首末顶点，曲线在首末端点处分别与控制多边形首末边相切。（和 贝塞尔曲线的性质一样）

### 等价形式

NURBS曲线方程可写为如下等价形式:

（相当于把除了 $P_i$ 之外的部分写成了一个函数 $R_{i,k}(t)$）
$$
P(t)=\Sigma_{i=0}^nP_iR_{i,k}(t)
$$
其中，$R_{i,k}(t)$ 的定义为：
$$
R_{i,k}(t)=\dfrac{\omega_iN_{i,k}(t)}{\Sigma_{i=0}^nw_iN_{i,k}(t)}
$$
• Ri,k(*t*)称为*k*阶有理基函数，与*k*阶规范B样条基函数*N**i,k*(*t*) 类似的性质:

- –  局部支撑性质:即*t*不在区间[*t**i*,*t**i+k*]内时, *R**i,k*(*t*)=0;
- –  规范性:∑*R**i,k*(*t*)=1;
- –  可微性:如果分母不为零，在节点区间内是无限次 连续可微的，在节点处是(*k*-*r-1)*次可微的，*r*为该节

点的重复度。

### 相关联系

非有理/有理贝塞尔曲线，非有理 B 样条曲线（一般的 B 样条曲线）都是有理 B 样条曲线（NURBS）的特例。

- 局部性质:

  –若移动k阶NURBS曲线的控制顶点Pi或改变所联系的 权因子将仅仅影响定义在区间[ti,ti+k]上那部分曲 线的形状，对NURBS曲线的其它部分不发生影响;

  这和一般的 B 样条曲线的性质一致。

  –K阶NURBS曲线上参数为t∈[ti,ti+1]的一点P(t)至多 与k个控制顶点Pi及相联系的权因子ωj(j=i-k+1,i- k+1,...,i)有关，与其它顶点及权因子无关。

- 变差缩减性

- 在仿射变换和透视变换下的不变性

### 权因子的几何意义

权因子即 $\omega_i$，由于它在方程中和 $N_{i,k}(t)$ 相乘，因此也受到基函数非零区间的限制：更改权因子只能更改曲线中一部分的形状（在 $N_{i,k}(t)$ 非零区域的形状）

即：更改 $\omega_i$ 时，只有 $[t_i,t_{i+k}]$ 范围内的曲线会被影响。
