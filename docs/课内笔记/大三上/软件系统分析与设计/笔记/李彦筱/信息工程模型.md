# 信息工程模型

## 基本概念和术语

数据是信息的载体。数据用来表示信息，且它可以直接被计算机存储。

数据的基本单位是「数据元素」。比如，

```java
class Employee{
    private String name;
    private int age;
}
```

的一个对象是一个数据元素。

- 一般计算机每次把一个数据元素当作整体处理

数据项：有的数据元素由数据项组成（比如上边那个类里，一个数据元素包含两个项：姓名和年龄）。数据项是数据存在的最小单位。

数据结构：**某一数据元素的集合**和**该集合中所有数据元素之间的关系**构成。

数据元素之间的关系有四种基本的类型：

- 集合（数据元素除了都属于同一个集合外，没有其他关系）
- 线性结构（结构的元素之间存在一对一关系）
- 树状结构（数据元素间存在一对多的关系）
- 图状结构或者网状结构（网就是特殊的图）（数据元素间存在多对多关系）

### 抽象数据类型

ADT 是一个数据模型和定义在该模型上的一系列操作

具体数据结构（Data Structure，DS）在其对应的 ADT 的指导下，描述数据具体应当如何存储，数据间的逻辑关系应当如何存储，以及数据的操作如何具体实现。

**ADT**的形式化定义是三元组：ADT=(D，S，P) – 其中：D是数据对象，S 是D上的关系集，P是对D的基本操作集。

> 即：ADT = 数据结构（D,S） + 基本操作集（P）

### 数据建模的基本概念

数据建模：组织和记录系统数据的技术，即数据库建模

实体关系图 ERD：利用符号标记实体和关系，实现对数据描述和刻画

### 实体

实体是指现实世界中一个需要被建模的物体，应当使用名词命名。

在数据库中，一个实体通常对应一张表；在面向对象程序设计中，一个实体通常对应一个实体类。通过 MyBatis 等数据库-实体类映射工具，我们可以通过修改实体类对象的属性，方便的修改数据库中存储的数据。

比如，客户、代理、部门；图书、机器、部件；账号、课程、时间段，这些名词性的概念都是实体。

实体具有多种属性。实体的属性是从其现实世界的特征中抽象出来的，比如学生实体通常具有属性「学号」、「班级」、「班主任」。

实体的属性也具有一些属性，不过为了防止太难描述，我们将「属性的属性」称为「特征」。属性的特征通常是固定的，任何属性的特征都基本相同。属性常见的特征包含：

- 数据类型：表示此属性可以存储什么类型的参数，比如 int, varchar, char, blob, datetime
- 默认值：如果用户在系统中创建实体时没有指定此属性的值，此属性默认应当为什么值。
- 域：属性可取值的范围

以下两个特征在 ppt 上定义为属性的特征，但我认为应当是实体的特征：

- 候选键：一组能够在实体集合中，唯一确定任何一个实体的属性集合

  比如，一个学校中，每个学生的学号都是互不相同的，因此学号是「学生」实体的候选键，因为可以通过「学生」实体的「学号」属性查找到某个学生实体。

- 主键：可能有多组候选键存在，但在数据库实现中，只能选择一组候选键；主键就是被选择用于作为唯一标识的一个候选键。

三大范式中提到的主属性=主键。

### 关系

关系是存在于一个或者多个实体之间的联系。

> 关系在单一实体-同一实体之间存在，此时的关系称为递归关系。

关系具有如下属性：

- 聚集（基数）： 定义了一个实体相对于另一个关联实体的某个具体值的最小或最大具体值的数量。

  比如，1 对 n 关系中，1 这侧的基数就是 1，n 这侧的基数就是 n。

- 度数： 是参与某一个关系的实体数量。两个实体通过某个关系相互联系，则此关系度数为 2。

### 外键

外键是一个实体的主键，但在另一个实体中同样出现，作为另一个实体的属性列。

- 外键总是和另一个实体的主键相互匹配
- 获得外键作为属性列的实体称为子实体
- 提供自身主键作为外键的实体称为父实体

根据外键是否也作为另一个实体的主键，存在两种情况：

非确定性关系：每个参与关系的实体都有独立的主键

即子实体中，获得的外键并不是主键的一部分。此时子实体称为独立实体（强实体）

确定性关系：子实体中的外键是其主键。此时子实体称为关联实体（弱实体）

> 在绘图中，两者的区别就是外键是否在子实体表的主键区域中

### 三大范式

- 第一范式：数据库表中的所有字段都是单一属性，不可再分的

  通俗：不能表中套表，不能出现一个属性列套了多个子属性列的情况。

  ![image-20241119113135887](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN2Z6RutQd48Rzsb0_iswUSk5q1iG4AAtwUAAIHrilVMjHzOYQzmc42BA.png)

  但是，一个属性列中可以存在多个值。比如，「手机号」子段中，如果用户真的有多个手机号，可以存储多个值在此列中。这样存储不算好，但并不视为违反第一范式。

- 第二范式：

  - 所有非候选键的属性必须完全函数依赖于所有的候选键（数据库课定义）

  - 数据库的表中不存在非关键字段对任一候选关键字段的部分函数依赖。（系统分析课定义）

    即表中所有非关键子段都必须依赖于所有主属性，不能只依赖于部分主属性。

  > 部分函数依赖是指存在组合关键字段中的某一个关键字段决定其它非关键字段的情况。部分函数依赖是数据库课程的概念，忘了也没关系，下面会举例简单介绍

  不能存在非主属性部分函数依赖于主属性，比如，假设有一张表：

  | 学号 | 姓名 | 课程名 | 课程成绩 | 班主任 |
  | ---- | ---- | ------ | -------- | ------ |

  「学号」和「课程名」是此表的主键（去掉「课程名」这一属性就无法唯一确定「课程成绩」）

  但是，姓名部分函数依赖于学号（姓名仅仅取决于学号，并不需要依赖课程名），班主任也部分函数依赖于学号（班主任只取决于学生学号是什么，不取决于课程名是什么），因此这张表不满足第二范式。

  这种表结构会出现数据冗余、修改困难的问题：学生有多少课程，姓名和班主任就存储了多少次，修改时就需要修改多少次。

- 第三范式：非主属性对任何非主属性都没有函数依赖（通俗：能通过非主属性计算得出的属性不要存储）

  （第三范式其实没必要一定满足；如果不满足第三范式性能反而更高，可以有条件的选择）
  
  比如，如下一张表中：
  
  | 订单 id | 产品金额 | 配送费 | 总金额 |
  | ------- | -------- | ------ | ------ |
  
  主键只有订单 id；总金额可以由产品金额+配送费得出，那么总金额就函数依赖于产品金额和配送费，这并不满足第三范式，我们可以删除总金额字段，在查询表时用聚集函数现场计算出总金额并且返回即可。
  
  不过，存储「总金额」这一属性并不会浪费太多空间；如果你认为现场计算总金额的开销超过了存储总金额的代价，也可以选择不遵守第三范式，存储总金额。

> 宽表：把所有字段一窝蜂的放在数据库表里，不分表，也不检查范式。
>
> 这种表看似很方便，实际操作的时候难用的要死。

### 好的数据模型的评价标准

> 这其实和三范式差不多等价

好的数据模型应当是：

- 简单的（满足第一范式，即不能有多值属性）
- 高效的（主键上定义了索引，因此是高效的）
- 无冗余的（通过第三范式，可以保证数据库中不存储冗余的数据）

保证原始设计结构尽可能稳定的情况下，可以进行如下两个工作：

- **灵活的**（需求变换的情况下，底层逻辑相对稳定）
- **可扩展的**（可以扩展当前的设计）

> 拓展：erwin 中的强关系和弱关系表示
>
> 强关系：子表的主键是父表的某个字段
>
> 弱关系：子表的某个属性是父表的属性的外键
>
> 两个圈：多对多
>
> 一侧有圈，一侧没圈：有圈是多，没圈是一。

> 矩阵（行/列代表同类元素的不同内容）可以用 m-n 联系中的那种表表示。

### 数据字典

数据字典用于存储一些「枚举」类的东西。比如，我设计的课程表中的每个课程有四种状态：未知、正常、缺勤、请假，但是这四个状态的名称可能会改变。为了让我心血来潮，更改状态名字的时候不更新整个数据库，我需要使用数据字典。

数据字典是指一张特殊的表，结构如下所示：

| 数据字典 ID | 数据类型 | 数据值 |
| ----------- | -------- | ------ |
| 1           | 001      | 未知   |
| 2           | 002      | 正常   |
| 3           | 003      | 缺勤   |
| 4           | 004      | 请假   |

数据字典 ID 就是这个表的正常主键。数据类型是指其他表中存储的「类型代码」，数据值是这个代码确切的含义。如果需要更改一个状态对应的名字，只需要更改数据值这一列就行了。

## 数据库完整性设置

完整性是 DBMS 提供的设置，要求数据库中的数据满足特定的条件。

1️⃣ **实体完整性**：关系的主码中的属性值不能为空值；不知道或无意义的值；（表的每一行在表中都是唯一的实体）主码的属性值不能完全重复。

2️⃣ **域完整性**：是指表中的列必须满足某种特定的数据类型约束 ，其中约束又包括取值范围、精度等规定。（即表一列中的数据需要满足此列声明时的数据结构）

3️⃣ **参照完整性**：是指两个表的主键和外键的数据应一致，保证了表之间的数据的一致性，防止了数据丢失或无意义的数据在数据库中扩散。 建立永久关联图，并设计关联上的参照完整性类型表。

> 被外键绑定的列可以是或者不是主键，但必须能唯一的表示此列的内容。

4️⃣ **用户定义的完整性**：不同的关系数据库系统根据其应用环境的不同，往往还需要一些特殊的约束条件。用户定义的完整性即是针对某个特定关系数据库的约束条件，它反映某一具体应用必须满足的语义要求。它是用户自行施加的。

## 数据库安全性设计

用户权限和存取控制：详见上学期数据库 UAC 那里

定义分配权限：记录当前用户的角色和具有系统部分的权限

## 画图规范

这里以 ERWin 的画法为例：

> 由于我没有 ERWin，这里从网上找张图片

![ERWIN中的一对多标识关系和一对多非标识关系_标识关系和非标识关系-CSDN博客](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN3Z6RutiJd7anxeIYaf9xMjI9BVyUAAt0UAAIHrilVpAABqmICZ-AcNgQ.jpeg)

在一对多关系中，1 的一方使用空心棱形或者圆圈表示，多的一方使用实心圆表示。

一对一关系和多对多关系都不常用到。

关系由外键实现。连线中，**实线代表两个实体间是确定性关系（子实体接收到的外键是其主键），虚线代表两个实体间是非确定性关系（子实体接收的外键不作为主键）**。

表画法：

![image-20241119112738147](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN4Z6RuubIJm2kvAyc5umjuKLwQLcYAAt4UAAIHrilVS9yWo7lB5B02BA.png)

画一个矩形框，只需要用一条横线分为两部分：上方为所有主属性的名称（后面加 PK 表示主键），下方是其他属性。

如果某个非主属性是外键，其应当在下半部分，且后面需要标记上 FK。

如果某个主属性是外键，其应当在上半部分，且后面需要标记上 FK 和 PK。

> 一般设计中，外键作为主键的设计很少见；如果你不确定该不该把外键作为子实体的主键，就不要。

此外，数据库中有时可能需要「泛化」这一关系。它的写法如下：

![](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN5Z6Rux5NgOzXnozoeCF0qzIhG9qgAAt8UAAIHrilVGc04NtGsIHE2BA.png)

上方是抽象的表，下方连线连接继承该表内容并添加新内容的子表。注意子表中只需要写出**新增的属性**，和父表中一样的属性不用写。

一般子表的主键是 id，都会换一个名称，因此子表的主键一般需要再次写出。

下面给出 MySQLWorkbench（和其他一些软件）的关系画法：

> 根据老师所说，使用哪种画法都可以，只要表述正确就行

![image-20241119111328801](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN6Z6RuyNzF6pLUINCP3jJkE6aQPUoAAuAUAAIHrilV_P1TNlIRp3s2BA.png)

一对一联系：两次都绘制两条短竖线

![image-20241119111407610](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN7Z6Ruyv-6PrWy1C-pk7g_WHywDxQAAuEUAAIHrilVd0AtAiIL2G42BA.png)

一对多联系：一的那边绘制两条双竖线，多的那边画一个箭头+一条竖线

多对多联系在实现中肯定会作为两个一对多联系实现，所以不用画。



## RBAC

RBAC：对细粒度的对象进行控制，精确到消息/事件级别

![image-20211219202640273](https://telegraph-image-5ms.pages.dev/file/BQACAgUAAyEGAASIfjD1AAN8Z6Ru1it7tl57ldDqRPHWl1E1P0EAAuIUAAIHrilVqO9HmZGLV_k2BA.png)

自主访问控制（DAC）：自己的资源自己说了算，可以选择分享/不分享

强制访问控制（MAC）：系统管理员统一定义能访问的内容，自己能访问的内容也不一定能分享给他人

会话：有的用户可能具有多个角色（比如助教老师同时也是研究生），会话用于记录当前用户登录是哪个角色，确保用户-角色存在多对多问题时，知道是什么角色。

Java 权限管理：基于每个传递的 Action 管理权限

> Action 包含发起者（事件源，对象）和接受者（操作），二者的结合就是权限

通过监控系统所有发出的 Action 并拒绝当前用户没有权限执行的 Action，可以极细粒度的控制权限。

## 自我测试

- 什么是数据元素？什么是数据项？二者的区别是什么？什么是数据的逻辑结构？
- （可选）线性、树、图、集合四种逻辑结构分别表示数据元素间具有什么关系？
- 什么是抽象数据类型（ADT），它由哪三部分组成？它是数据结构+什么构成的？
- 什么是候选键、主键和外键？外键中，确定性关系和非确定性关系都是指什么？